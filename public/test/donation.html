<html><body>

<a href="./index.html">home</a><br><br>

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<!--<script src="./seedapi.js"></script>-->
<script src="http://local.coop:8000/test/seedapi.js"></script>
<script src="./seedapiconfig.js"></script>

Step 1:<br>
<form id="step1Form">
  First Name: <input type="text" name="firstName" value="john2"><br>
  Last Name: <input type="text" name="lastName" value="doe"><br>
  Email: <input type="text" name="email" value="john2@doe.com"><br>
  Amount: <input id="step1Amount" type="text" name="amount" value="12"><br>
  <input id="step1Submit" type="submit" value="Next">
</form>
<br>
Step 2:
<form id="step2Form">
  Contribution Id: <input id="contributionId" type="text" name="contributionId"><br>
  Amount: <input id="step2Amount" type="text" name="amount"><br>
  Card Number: <input type="text" name="cardNumber" value="4242424242424242"><br>
  Card Exp Month: <input type="text" name="cardExpMonth" value="12"><br>
  Card Exp Year: <input type="text" name="cardExpYear" value="2016"><br>
  Card CVV: <input type="text" name="cardCvv" value="123"><br>
  Billing Zip: <input type="text" name="billingZip" value="94102"><br>
  Charge Description: <input type="text" name="description" value="test"><br>
  <input id="step2Submit" type="submit" value="Submit">
</form>
<br>
Status: <div id="paymentStatus"></div><br>
Error: <div id="errorMessage"></div>
<div id="errorStack"></div><br>
<br>
<div id="statusLink"></div><br>

<script>
  $("#step1Form").submit(handleStep1);
  $("#step2Form").submit(handleStep2);

//  var endpoint = 'http://seedbombing.dev.colab.coop';
//  var campaignId = 'NkvHV25Ql';

//  var endpoint = 'http://localhost:8000';
//  var campaignId = 'VJ7iA5cQg';
//
////  var endpoint = 'http://seed.stage.colab.coop';
////  var campaignId = 'N1bm2FjXx';
//  var apiKey = 'w4l';


  function handleStep1() {
    var form = document.getElementById("step1Form");
    var data = {campaignId: SeedApi.getCampaignId()};
    SeedApi.copyFormValues(data, form, ['firstName','lastName','email','amount']);
    SeedApi.submitPledge(data, handlePledgeResponse);
    return false;
  }

  function handlePledgeResponse(data) {
    var contributionId = data.result.contributionId;
//    alert('contributionId: ' + contributionId);
    $('#contributionId').val(contributionId);
    $('#step2Amount').val( $('#step1Amount').val() );
  }


  function handleStep2() {
    var form = document.getElementById("step2Form");
    var data = {};
    SeedApi.copyFormValues(data, form, ['contributionId','amount','cardNumber','cardExpMonth','cardExpYear','cardCvv','billingZip','description']);
    SeedApi.submitPaymentInfo(data, handlePaymentInfoResponse);
    return false;
  }

  function handlePaymentInfoResponse(data) {
//    alert('payment response: ' + JSON.stringify(data));
    if (data.result) {
      var status = data.result.status;
      $('#paymentStatus').html(status);
      var linkUrl = data.result.statusLink;
      var linkHtml = '<a href="' + linkUrl + '">' + linkUrl + '</a>';
      $('#statusLink').html(linkHtml);
    } else if (data.error) {
      $('#errorMessage').html(data.error.message);
      $('#errorStack').html('<pre>' + data.error.stack + '</pre>');
    }
  }


//  function submitPledge(data, successHandler) {
//    var uri = '/api/v1/campaign/' + data.campaignId + '/pledge.submit';
//    invoke(uri, data, successHandler);
//  }
//
//  function submitPaymentInfo(data, successHandler) {
//    var uri = '/api/v1/contribution/' + data.contributionId + '/paymentInfo.submit';
//    invoke(uri, data, successHandler);
//  }
//
//  function invoke(uri, data, successHandler) {
//    var url = endpoint + uri;
//    data.apiKey = apiKey;
//    $.ajax({
//      url: url
//      , dataType: 'jsonp'
//      , data: data
//      , success: successHandler
//      , error: function(xhr, status, error) { alert(status) }
//    });
//  }
//
//
//  function copyFormValues(data, form, fields) {
//    for (i = 0; i < fields.length; i++) {
//      data[fields[i]] = formValue(form, fields[i]);
//    }
//  }
//
//  function formValue(form, field) {
//    return form.elements[field].value;
//  }


</script>


</body></html>
