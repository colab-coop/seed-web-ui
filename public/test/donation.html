<html><body>

<a href="./index.html">home</a><br><br>

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="http://local.coop:8000/test/seedapi.js?v=1"></script>
<script src="./seedapiconfig.js"></script>

Step 1:<br>
<form id="step1Form">
  First Name: <input type="text" name="firstName" value="john2"><br>
  Last Name: <input type="text" name="lastName" value="doe"><br>
  Email: <input type="text" name="email" value="john2@doe.com"><br>
  Amount: <input id="step1Amount" type="text" name="amount" value="12"><br>
  <input id="step1Submit" type="submit" value="Next">
</form>
<br>
Step 2:
<form id="step2Form">
  Contribution Id: <input id="contributionId" type="text" name="contributionId"><br>
  Amount: <input id="step2Amount" type="text" name="amount"><br>
  Card Number: <input type="text" name="cardNumber" value="4242424242424242"><br>
  Card Exp Month: <input type="text" name="cardExpMonth" value="12"><br>
  Card Exp Year: <input type="text" name="cardExpYear" value="2016"><br>
  Card CVV: <input type="text" name="cardCvv" value="123"><br>
  Billing Zip: <input type="text" name="billingZip" value="94102"><br>
  Charge Description: <input type="text" name="description" value="test"><br>
  <input id="step2Submit" type="submit" value="Submit">
</form>
<br>
Status: <div id="paymentStatus"></div><br>
Error: <div id="errorMessage"></div>
<div id="errorStack"></div><br>
<br>
<div id="statusLink"></div><br>

<script>
  $("#step1Form").submit(handleStep1);
  $("#step2Form").submit(handleStep2);


  function handleStep1() {
    var form = document.getElementById("step1Form");
    var data = {};
    SeedApi.copyFormValues(data, form, ['firstName','lastName','email','amount']);
    SeedApi.submitPledge(data, handlePledgeResponse);
    return false;
  }

  function handlePledgeResponse(data) {
    var contributionId = data.result.contributionId;
//    alert('contributionId: ' + contributionId);
    $('#contributionId').val(contributionId);
    $('#step2Amount').val( $('#step1Amount').val() );
  }


  function handleStep2() {
    var form = document.getElementById("step2Form");
    var data = {};
    SeedApi.copyFormValues(data, form, ['contributionId','amount','cardNumber','cardExpMonth','cardExpYear','cardCvv','billingZip','description']);
    SeedApi.submitPaymentInfo(data, handlePaymentInfoResponse);
    return false;
  }

  function handlePaymentInfoResponse(data) {
//    alert('payment response: ' + JSON.stringify(data));
    if (data.result) {
      var status = data.result.status;
      $('#paymentStatus').html(status);
      var linkUrl = data.result.statusLink;
      var linkHtml = '<a href="' + linkUrl + '">' + linkUrl + '</a>';
      $('#statusLink').html(linkHtml);
    } else if (data.error) {
      $('#errorMessage').html(data.error.message);
      $('#errorStack').html('<pre>' + data.error.stack + '</pre>');
    }
  }


</script>


</body></html>
