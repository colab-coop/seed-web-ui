<html><body onload="populateStatus();">

<a href="./index.html">home</a><br><br>

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="./seedapi.js"></script>
<script src="./seedapiconfig.js"></script>

<h3>Donation Status:</h3>

<div id="status"></div><br>
<br>
<br>
<a href="javascript:endRecurring()">End Recurring</a><br>
<div id="status2"></div><br>

<div id="rawStatus"></div><br>
<div id="errorMessage"></div><br>
<div id="errorStack"></div><br>


<script>

//  function getParameterByName(name) {
//    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
//    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
//  }

  function populateStatus() {
    var contributionId = SeedApi.getParameterByName('c');
//    alert('contrib id: ' + contributionId);
    SeedApi.fetchContributionStatus({contributionId: contributionId}, handleStatus);
  }

  function handleStatus(data) {
//    alert('status data: ' + JSON.stringify(data));
    if (data.result) {
      $('#rawStatus').html('Raw Status: ' + JSON.stringify(data.result));
      var h = 'Amount: ' + data.result.amount + '<br>' +
          'Status: ' + data.result.status;
      $('#status').html(h);
    } else if (data.error) {
//      $('#error').html('error: ' + JSON.stringify(data.error));
      $('#errorMessage').html('Error: ' + data.error.message);
      $('#errorStack').html('<pre>' + data.error.stack + '</pre>');
    }
    return false;
  }

  function endRecurring() {
    var contributionId = SeedApi.getParameterByName('c');
//    alert('contrib id: ' + contributionId);
    SeedApi.endRecurringContribution({contributionId: contributionId}, handleEndResult);
    return false;
  }

  function handleEndResult(data) {
//    alert('data: ' + JSON.stringify(data));
    if (data.result) {
      $('#status2').html(JSON.stringify(data.result));
    } else if (data.error) {
//      $('#error2').html('error: ' + data.error.message);
      $('#errorMessage').html('Error: ' + data.error.message);
      $('#errorStack').html('<pre>' + data.error.stack + '</pre>');
    }
  }

</script>


</body></html>
